---
// Starfield background component
---

<canvas id="starfield" class="absolute inset-0 w-full h-full" style="z-index: -10 !important;"></canvas>

<script>
  const canvas = document.getElementById('starfield') as HTMLCanvasElement;
  const ctx = canvas.getContext('2d')!;

  let stars: Star[] = [];
  let shootingStars: ShootingStar[] = [];
  const STAR_COUNT = 250;
  const SHOOTING_STAR_MIN_INTERVAL = 1000;
  const SHOOTING_STAR_MAX_INTERVAL = 5000;
  let lastShootingStarTime = 0;

  function setCanvasSize() {
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
  }

  setCanvasSize();
  window.addEventListener('resize', setCanvasSize);

  class Star {
    x: number;
    y: number;
    radius: number;
    opacity: number;
    twinkleSpeed: number;
    direction: number;

    constructor() {
      this.x = Math.random() * canvas.width;
      this.y = Math.random() * canvas.height;
      this.radius = Math.random() * 1.5 + 0.5;
      this.opacity = Math.random();
      this.twinkleSpeed = Math.random() * 0.02 + 0.01;
      this.direction = Math.random() > 0.5 ? 1 : -1;
    }

    draw() {
      ctx.beginPath();
      ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2);
      ctx.fillStyle = `rgba(255, 255, 255, ${this.opacity})`;
      ctx.fill();
    }

    update() {
      this.opacity += this.direction * this.twinkleSpeed;
      if (this.opacity > 1 || this.opacity < 0) {
        this.direction *= -1;
      }
    }
  }

  class ShootingStar {
    x: number;
    y: number;
    length: number;
    speed: number;
    opacity: number;
    angle: number;

    constructor() {
      this.x = Math.random() * canvas.width;
      this.y = (Math.random() * canvas.height) / 4;
      this.length = Math.random() * 80 + 40;
      this.speed = Math.random() * 6 + 4;
      this.opacity = 0.5;
      this.angle = Math.PI / 4 + ((Math.random() * Math.PI) / 8) * (Math.random() > 0.5 ? 1 : -1);

      if (Math.random() > 0.5) {
        this.x = canvas.width - this.x;
        this.angle = Math.PI - this.angle;
      }
    }

    draw() {
      ctx.beginPath();
      ctx.moveTo(this.x, this.y);
      ctx.lineTo(
        this.x + Math.cos(this.angle) * this.length,
        this.y + Math.sin(this.angle) * this.length
      );
      ctx.strokeStyle = `rgba(255, 255, 255, ${this.opacity})`;
      ctx.lineWidth = 1.5;
      ctx.stroke();
    }

    update() {
      this.x += Math.cos(this.angle) * this.speed;
      this.y += Math.sin(this.angle) * this.speed;
      this.opacity -= 0.015;

      return (
        this.opacity <= 0 ||
        this.x < 0 ||
        this.x > canvas.width ||
        this.y > canvas.height
      );
    }
  }

  function initStars() {
    stars = [];
    for (let i = 0; i < STAR_COUNT; i++) {
      stars.push(new Star());
    }
  }

  initStars();

  function animate(currentTime: number) {
    ctx.clearRect(0, 0, canvas.width, canvas.height);

    stars.forEach((star) => {
      star.update();
      star.draw();
    });

    if (
      currentTime - lastShootingStarTime >
      SHOOTING_STAR_MIN_INTERVAL +
        Math.random() * (SHOOTING_STAR_MAX_INTERVAL - SHOOTING_STAR_MIN_INTERVAL)
    ) {
      shootingStars.push(new ShootingStar());
      lastShootingStarTime = currentTime;
    }

    shootingStars = shootingStars.filter((ss) => {
      ss.draw();
      return !ss.update();
    });

    requestAnimationFrame(animate);
  }

  requestAnimationFrame(animate);
</script>
